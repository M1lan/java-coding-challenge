
<html>
  <head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Async Data Fetcher Viewer</title>
	<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet">
	<style>
body {margin:0; background:#121212; color:#eee; font-family:Arial, sans-serif;}
.container {padding:20px; max-width:1200px; margin:0 auto;}
.glass {background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); border-radius:8px; padding:20px; backdrop-filter:blur(10px);}
button {background:none; border:1px solid transparent; color:#eee; padding:10px 20px; margin:5px; cursor:pointer; border-radius:4px; transition:all 0.3s;}
button:hover {border-color:#ff00ff; color:#ff00ff;}
pre {font-family:'Source Code Pro', monospace; font-size:14px; white-space:pre-wrap; word-wrap:break-word; background:#1e1e1e; padding:20px; border-radius:8px; overflow:auto;}
#jsonGraph {width:100%; height:600px;}
.hidden {display:none;}
</style>
</head>
<body>
<div class="container">
<div class="glass">
<button id="codeBtn">Code View</button>
<button id="graphBtn">Graph View</button>
</div>
<div id="codeView" class="glass" style="margin-top:20px;">
<pre><code id="jsonCode"></code></pre>
</div>
<div id="graphView" class="glass hidden" style="margin-top:20px;">
<svg id="jsonGraph" width="960" height="600"></svg>
</div>
</div>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
function buildTree(key,value){
 var node={name:key};
 if(value!==null && typeof value==="object"){
  if(Array.isArray(value)){
   node.children=value.map((d,i)=>buildTree("["+i+"]",d));
  } else {
   node.children=Object.keys(value).map(k=>buildTree(k,value[k]));
  }
 } else {node.name+=": "+value;}
 return node;
}
function renderGraph(data){
 var treeData=buildTree("MergedData",data);
 var svg=d3.select("#jsonGraph"),
     width=+svg.attr("width"),
     height=+svg.attr("height"),
     margin={top:20,right:90,bottom:30,left:90};
 svg.selectAll("*").remove();
 var g=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")"),
     treemap=d3.tree().size([height-margin.top-margin.bottom,width-margin.left-margin.right]),
     root=d3.hierarchy(treeData,d=>d.children);
 root=treemap(root);
 var link=g.selectAll(".link")
  .data(root.links())
  .enter().append("path")
  .attr("class","link")
  .attr("fill","none")
  .attr("stroke","#ff00ff")
  .attr("stroke-opacity",0.5)
  .attr("stroke-width",2)
  .attr("d",d3.linkHorizontal().x(d=>d.y).y(d=>d.x));
 var node=g.selectAll(".node")
  .data(root.descendants())
  .enter().append("g")
  .attr("class","node")
  .attr("transform",d=>"translate("+d.y+","+d.x+")");
 node.append("circle")
  .attr("r",4)
  .attr("fill","#eee");
 node.append("text")
  .attr("dy",3)
  .attr("x",d=>d.children ? -8 : 8)
  .style("text-anchor",d=>d.children ? "end" : "start")
  .attr("fill","#eee")
  .text(d=>d.data.name);
}
function showCodeView(){
 document.getElementById("codeView").classList.remove("hidden");
 document.getElementById("graphView").classList.add("hidden");
}
function showGraphView(){
 document.getElementById("graphView").classList.remove("hidden");
 document.getElementById("codeView").classList.add("hidden");
}
document.getElementById("codeBtn").addEventListener("click",showCodeView);
document.getElementById("graphBtn").addEventListener("click",showGraphView);
fetch("/api/merged").then(res=>res.json()).then(data=>{
 document.getElementById("jsonCode").textContent=JSON.stringify(data,null,2);
 renderGraph(data);
});
</script>
</body>
</html>
